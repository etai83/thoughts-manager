{"version":3,"sources":["../../src/components/internal-document-id-store.ts"],"sourcesContent":["import { AnyOrama } from '../types.js'\n\nexport type DocumentID = string | number\nexport type InternalDocumentID = number\n\nexport type InternalDocumentIDStore = {\n  idToInternalId: Map<string, number>\n  internalIdToId: string[]\n  save: (store: InternalDocumentIDStore) => unknown\n  load: <T extends AnyOrama>(orama: T, raw: unknown) => void\n}\n\nexport function createInternalDocumentIDStore(): InternalDocumentIDStore {\n  return {\n    idToInternalId: new Map(),\n    internalIdToId: [],\n    save,\n    load\n  }\n}\n\nexport function save(store: InternalDocumentIDStore): unknown {\n  return {\n    internalIdToId: store.internalIdToId\n  }\n}\n\nexport function load<T extends AnyOrama>(orama: T, raw: unknown): void {\n  const { internalIdToId } = raw as InternalDocumentIDStore\n\n  orama.internalDocumentIDStore.idToInternalId.clear()\n  orama.internalDocumentIDStore.internalIdToId = []\n  const internalIdToIdLength = internalIdToId.length\n\n  for (let i = 0; i < internalIdToIdLength; i++) {\n    const internalIdItem = internalIdToId[i]\n    orama.internalDocumentIDStore.idToInternalId.set(internalIdItem, i + 1)\n    orama.internalDocumentIDStore.internalIdToId.push(internalIdItem)\n  }\n}\n\nexport function getInternalDocumentId(store: InternalDocumentIDStore, id: DocumentID): InternalDocumentID {\n  if (typeof id === 'string') {\n    const internalId = store.idToInternalId.get(id)\n\n    if (internalId) {\n      return internalId\n    }\n\n    const currentId = store.idToInternalId.size + 1\n\n    store.idToInternalId.set(id, currentId)\n    store.internalIdToId.push(id)\n\n    return currentId\n  }\n\n  if (id > store.internalIdToId.length) {\n    return getInternalDocumentId(store, id.toString())\n  }\n\n  return id\n}\n\nexport function getDocumentIdFromInternalId(store: InternalDocumentIDStore, internalId: InternalDocumentID): string {\n  if (store.internalIdToId.length < internalId) {\n    throw new Error(`Invalid internalId ${internalId}`)\n  }\n\n  return store.internalIdToId[internalId - 1]\n}\n"],"names":["createInternalDocumentIDStore","idToInternalId","Map","internalIdToId","save","load","store","orama","raw","internalDocumentIDStore","clear","internalIdToIdLength","length","i","internalIdItem","set","push","getInternalDocumentId","id","internalId","get","currentId","size","toString","getDocumentIdFromInternalId","Error"],"mappings":"AAYA,OAAO,SAASA,gCAAyD;IACvE,OAAO;QACLC,gBAAgB,IAAIC;QACpBC,gBAAgB,EAAE;QAClBC;QACAC;IACF;AACF,CAAC;AAED,OAAO,SAASD,KAAKE,KAA8B,EAAW;IAC5D,OAAO;QACLH,gBAAgBG,MAAMH,cAAc;IACtC;AACF,CAAC;AAED,OAAO,SAASE,KAAyBE,KAAQ,EAAEC,GAAY,EAAQ;IACrE,MAAM,EAAEL,eAAc,EAAE,GAAGK;IAE3BD,MAAME,uBAAuB,CAACR,cAAc,CAACS,KAAK;IAClDH,MAAME,uBAAuB,CAACN,cAAc,GAAG,EAAE;IACjD,MAAMQ,uBAAuBR,eAAeS,MAAM;IAElD,IAAK,IAAIC,IAAI,GAAGA,IAAIF,sBAAsBE,IAAK;QAC7C,MAAMC,iBAAiBX,cAAc,CAACU,EAAE;QACxCN,MAAME,uBAAuB,CAACR,cAAc,CAACc,GAAG,CAACD,gBAAgBD,IAAI;QACrEN,MAAME,uBAAuB,CAACN,cAAc,CAACa,IAAI,CAACF;IACpD;AACF,CAAC;AAED,OAAO,SAASG,sBAAsBX,KAA8B,EAAEY,EAAc,EAAsB;IACxG,IAAI,OAAOA,OAAO,UAAU;QAC1B,MAAMC,aAAab,MAAML,cAAc,CAACmB,GAAG,CAACF;QAE5C,IAAIC,YAAY;YACd,OAAOA;QACT,CAAC;QAED,MAAME,YAAYf,MAAML,cAAc,CAACqB,IAAI,GAAG;QAE9ChB,MAAML,cAAc,CAACc,GAAG,CAACG,IAAIG;QAC7Bf,MAAMH,cAAc,CAACa,IAAI,CAACE;QAE1B,OAAOG;IACT,CAAC;IAED,IAAIH,KAAKZ,MAAMH,cAAc,CAACS,MAAM,EAAE;QACpC,OAAOK,sBAAsBX,OAAOY,GAAGK,QAAQ;IACjD,CAAC;IAED,OAAOL;AACT,CAAC;AAED,OAAO,SAASM,4BAA4BlB,KAA8B,EAAEa,UAA8B,EAAU;IAClH,IAAIb,MAAMH,cAAc,CAACS,MAAM,GAAGO,YAAY;QAC5C,MAAM,IAAIM,MAAM,CAAC,mBAAmB,EAAEN,WAAW,CAAC,EAAC;IACrD,CAAC;IAED,OAAOb,MAAMH,cAAc,CAACgB,aAAa,EAAE;AAC7C,CAAC"}