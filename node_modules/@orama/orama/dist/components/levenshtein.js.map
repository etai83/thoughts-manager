{"version":3,"sources":["../../src/components/levenshtein.ts"],"sourcesContent":["export type BoundedMetric = {\n  isBounded: boolean\n  distance: number\n}\n\n/**\n * Inspired by:\n * https://github.com/Yomguithereal/talisman/blob/86ae55cbd040ff021d05e282e0e6c71f2dde21f8/src/metrics/levenshtein.js#L218-L340\n */\nfunction _boundedLevenshtein(a: string, b: string, tolerance: number): number {\n  // Handle base cases\n  if (tolerance < 0) return -1\n  if (a === b) return 0\n\n  const m = a.length\n  const n = b.length\n\n  // Special case for empty strings\n  if (m === 0) return n <= tolerance ? n : -1\n  if (n === 0) return m <= tolerance ? m : -1\n\n  a = a.toLowerCase()\n  b = b.toLowerCase()\n\n  // Special case for prefixes\n  if (b.startsWith(a) || a.startsWith(b)) return 0\n\n  // If the length difference is greater than the tolerance, return early\n  if (Math.abs(m - n) > tolerance) return -1\n\n  // Initialize the matrix\n  const matrix: number[][] = []\n  for (let i = 0; i <= m; i++) {\n    matrix[i] = [i]\n    for (let j = 1; j <= n; j++) {\n      matrix[i][j] = i === 0 ? j : 0\n    }\n  }\n\n  // Fill the matrix\n  for (let i = 1; i <= m; i++) {\n    let rowMin = Infinity\n    for (let j = 1; j <= n; j++) {\n      if (a[i - 1] === b[j - 1]) {\n        matrix[i][j] = matrix[i - 1][j - 1]\n      } else {\n        matrix[i][j] = Math.min(\n          matrix[i - 1][j] + 1, // deletion\n          matrix[i][j - 1] + 1, // insertion\n          matrix[i - 1][j - 1] + 1 // substitution\n        )\n      }\n      rowMin = Math.min(rowMin, matrix[i][j])\n    }\n\n    // Early termination if all values in this row exceed tolerance\n    if (rowMin > tolerance) {\n      return -1\n    }\n  }\n\n  return matrix[m][n] <= tolerance ? matrix[m][n] : -1\n}\n\n/**\n * Computes the Levenshtein distance between two strings (a, b), returning early with -1 if the distance\n * is greater than the given tolerance.\n * It assumes that:\n * - tolerance >= ||a| - |b|| >= 0\n */\nexport async function boundedLevenshtein(a: string, b: string, tolerance: number): Promise<BoundedMetric> {\n  const distance = _boundedLevenshtein(a, b, tolerance)\n  return {\n    distance,\n    isBounded: distance >= 0\n  }\n}\n\n// This is only used internally, keep in sync with the previous one\nexport function syncBoundedLevenshtein(a: string, b: string, tolerance: number): BoundedMetric {\n  const distance = _boundedLevenshtein(a, b, tolerance)\n  return {\n    distance,\n    isBounded: distance >= 0\n  }\n}\n\nexport function levenshtein(a: string, b: string): number {\n  /* c8 ignore next 3 */\n  if (!a.length) {\n    return b.length\n  }\n\n  /* c8 ignore next 3 */\n  if (!b.length) {\n    return a.length\n  }\n\n  const swap = a\n  if (a.length > b.length) {\n    a = b\n    b = swap\n  }\n\n  const row = Array.from({ length: a.length + 1 }, (_, i) => i)\n  let val = 0\n\n  for (let i = 1; i <= b.length; i++) {\n    let prev = i\n\n    for (let j = 1; j <= a.length; j++) {\n      if (b[i - 1] === a[j - 1]) {\n        val = row[j - 1]\n      } else {\n        val = Math.min(row[j - 1] + 1, Math.min(prev + 1, row[j] + 1))\n      }\n\n      row[j - 1] = prev\n      prev = val\n    }\n    row[a.length] = prev\n  }\n\n  return row[a.length]\n}\n"],"names":["_boundedLevenshtein","a","b","tolerance","m","length","n","toLowerCase","startsWith","Math","abs","matrix","i","j","rowMin","Infinity","min","boundedLevenshtein","distance","isBounded","syncBoundedLevenshtein","levenshtein","swap","row","Array","from","_","val","prev"],"mappings":"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"}