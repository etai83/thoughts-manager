{"version":3,"sources":["../src/utils.ts"],"sourcesContent":["import type { AnyDocument, GeosearchDistanceUnit, Results, SearchableValue, TokenScore } from './types.js'\nimport { createError } from './errors.js'\n\nconst baseId = Date.now().toString().slice(5)\nlet lastId = 0\n\nconst k = 1024\nconst nano = BigInt(1e3)\nconst milli = BigInt(1e6)\nconst second = BigInt(1e9)\n\nexport const isServer = typeof window === 'undefined'\n\n/**\n * This value can be increased up to 100_000\n * But i don't know if this value change from nodejs to nodejs\n * So I will keep a safer value here.\n */\nexport const MAX_ARGUMENT_FOR_STACK = 65535\n\n/**\n * This method is needed to used because of issues like: https://github.com/askorama/orama/issues/301\n * that issue is caused because the array that is pushed is huge (>100k)\n *\n * @example\n * ```ts\n * safeArrayPush(myArray, [1, 2])\n * ```\n */\nexport function safeArrayPush<T>(arr: T[], newArr: T[]): void {\n  if (newArr.length < MAX_ARGUMENT_FOR_STACK) {\n    Array.prototype.push.apply(arr, newArr)\n  } else {\n    const newArrLength = newArr.length\n    for (let i = 0; i < newArrLength; i += MAX_ARGUMENT_FOR_STACK) {\n      Array.prototype.push.apply(arr, newArr.slice(i, i + MAX_ARGUMENT_FOR_STACK))\n    }\n  }\n}\n\nexport function sprintf(template: string, ...args: Array<string | number>): string {\n  return template.replace(\n    /%(?:(?<position>\\d+)\\$)?(?<width>-?\\d*\\.?\\d*)(?<type>[dfs])/g,\n    function (...replaceArgs: Array<string | number | Record<string, string>>): string {\n      const groups = replaceArgs[replaceArgs.length - 1] as Record<string, string>\n      const { width: rawWidth, type, position } = groups\n\n      const replacement = position ? args[Number.parseInt(position) - 1]! : args.shift()!\n      const width = rawWidth === '' ? 0 : Number.parseInt(rawWidth)\n\n      switch (type) {\n        case 'd':\n          return replacement.toString().padStart(width, '0')\n        case 'f': {\n          let value = replacement\n          const [padding, precision] = rawWidth.split('.').map((w) => Number.parseFloat(w))\n\n          if (typeof precision === 'number' && precision >= 0) {\n            value = (value as number).toFixed(precision)\n          }\n\n          return typeof padding === 'number' && padding >= 0 ? value.toString().padStart(width, '0') : value.toString()\n        }\n        case 's':\n          return width < 0\n            ? (replacement as string).toString().padEnd(-width, ' ')\n            : (replacement as string).toString().padStart(width, ' ')\n\n        default:\n          return replacement as string\n      }\n    }\n  )\n}\n\nexport async function formatBytes(bytes: number, decimals = 2): Promise<string> {\n  if (bytes === 0) {\n    return '0 Bytes'\n  }\n  const dm = decimals < 0 ? 0 : decimals\n  const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']\n  const i = Math.floor(Math.log(bytes) / Math.log(k))\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`\n}\n\nexport function isInsideWebWorker(): boolean {\n  // @ts-expect-error - WebWorker global scope\n  return typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope\n}\n\nexport function isInsideNode(): boolean {\n  return typeof process !== 'undefined' && process.release && process.release.name === 'node'\n}\n\nexport function getNanosecondTimeViaPerformance() {\n  return BigInt(Math.floor(performance.now() * 1e6))\n}\n\nexport async function formatNanoseconds(value: number | bigint): Promise<string> {\n  if (typeof value === 'number') {\n    value = BigInt(value)\n  }\n\n  if (value < nano) {\n    return `${value}ns`\n  } else if (value < milli) {\n    return `${value / nano}Î¼s`\n  } else if (value < second) {\n    return `${value / milli}ms`\n  }\n\n  return `${value / second}s`\n}\n\n// TODO: none of these operations is async. Should we change the signature of this function?\nexport async function getNanosecondsTime(): Promise<bigint> {\n  if (isInsideWebWorker()) {\n    return getNanosecondTimeViaPerformance()\n  }\n\n  if (isInsideNode()) {\n    return process.hrtime.bigint()\n  }\n\n  if (typeof process !== 'undefined' && typeof process?.hrtime?.bigint === 'function') {\n    return process.hrtime.bigint()\n  }\n\n  if (typeof performance !== 'undefined') {\n    return getNanosecondTimeViaPerformance()\n  }\n\n  // @todo: fallback to V8 native method to get microtime\n  return BigInt(0)\n}\n\nexport async function uniqueId(): Promise<string> {\n  return `${baseId}-${lastId++}`\n}\n\nexport function getOwnProperty<T = unknown>(object: Record<string, T>, property: string): T | undefined {\n  // Checks if `hasOwn` method is defined avoiding errors with older Node.js versions\n  if (Object.hasOwn === undefined) {\n    return Object.prototype.hasOwnProperty.call(object, property) ? object[property] : undefined\n  }\n\n  return Object.hasOwn(object, property) ? object[property] : undefined\n}\n\nexport function getTokenFrequency(token: string, tokens: string[]): number {\n  let count = 0\n\n  for (const t of tokens) {\n    if (t === token) {\n      count++\n    }\n  }\n\n  return count\n}\n\nexport function insertSortedValue(\n  arr: TokenScore[],\n  el: TokenScore,\n  compareFn = sortTokenScorePredicate\n): TokenScore[] {\n  let low = 0\n  let high = arr.length\n  let mid\n\n  while (low < high) {\n    mid = (low + high) >>> 1\n    if (compareFn(el, arr[mid]) < 0) {\n      high = mid\n    } else {\n      low = mid + 1\n    }\n  }\n\n  arr.splice(low, 0, el)\n\n  return arr\n}\n\nexport function sortTokenScorePredicate(a: TokenScore, b: TokenScore): number {\n  if (b[1] === a[1]) {\n    return a[0] - b[0]\n  }\n\n  return b[1] - a[1]\n}\n\n// Intersection function taken from https://github.com/lovasoa/fast_array_intersect.\n// MIT Licensed at the time of writing.\nexport function intersect<T>(arrays: Array<readonly T[]>): T[] {\n  if (arrays.length === 0) {\n    return []\n  } else if (arrays.length === 1) {\n    return arrays[0] as T[]\n  }\n\n  for (let i = 1; i < arrays.length; i++) {\n    if (arrays[i].length < arrays[0].length) {\n      const tmp = arrays[0]\n      arrays[0] = arrays[i]\n      arrays[i] = tmp\n    }\n  }\n\n  const set = new Map()\n  for (const elem of arrays[0]) {\n    set.set(elem, 1)\n  }\n  for (let i = 1; i < arrays.length; i++) {\n    let found = 0\n    for (const elem of arrays[i]) {\n      const count = set.get(elem)\n      if (count === i) {\n        set.set(elem, count + 1)\n        found++\n      }\n    }\n    if (found === 0) return []\n  }\n\n  return arrays[0].filter((e) => {\n    const count = set.get(e)\n    if (count !== undefined) set.set(e, 0)\n    return count === arrays.length\n  })\n}\n\nexport async function getDocumentProperties(\n  doc: AnyDocument,\n  paths: string[]\n): Promise<Record<string, SearchableValue>> {\n  const properties: Record<string, SearchableValue> = {}\n\n  const pathsLength = paths.length\n  for (let i = 0; i < pathsLength; i++) {\n    const path = paths[i]\n    const pathTokens = path.split('.')\n\n    let current: SearchableValue | AnyDocument | undefined = doc\n    const pathTokensLength = pathTokens.length\n    for (let j = 0; j < pathTokensLength; j++) {\n      current = current[pathTokens[j]!]\n\n      // We found an object but we were supposed to be done\n      if (typeof current === 'object') {\n        if (\n          current !== null &&\n          'lat' in current &&\n          'lon' in current &&\n          typeof current.lat === 'number' &&\n          typeof current.lon === 'number'\n        ) {\n          current = properties[path] = current as SearchableValue\n          break\n        } else if (!Array.isArray(current) && current !== null && j === pathTokensLength - 1) {\n          current = undefined\n          break\n        }\n      } else if ((current === null || typeof current !== 'object') && j < pathTokensLength - 1) {\n        // We can't recurse anymore but we were supposed to\n        current = undefined\n        break\n      }\n    }\n\n    if (typeof current !== 'undefined') {\n      properties[path] = current as SearchableValue\n    }\n  }\n\n  return properties\n}\n\nexport async function getNested<T = SearchableValue>(obj: object, path: string): Promise<T | undefined> {\n  const props = await getDocumentProperties(obj as AnyDocument, [path])\n\n  return props[path] as T | undefined\n}\n\nexport function flattenObject(obj: object, prefix = ''): AnyDocument {\n  const result: AnyDocument = {}\n\n  for (const key in obj) {\n    const prop = `${prefix}${key}`\n    const objKey = (obj as AnyDocument)[key]\n\n    if (typeof objKey === 'object' && objKey !== null) {\n      Object.assign(result, flattenObject(objKey, `${prop}.`))\n    } else {\n      result[prop] = objKey\n    }\n  }\n  return result\n}\n\nconst mapDistanceToMeters = {\n  cm: 0.01,\n  m: 1,\n  km: 1000,\n  ft: 0.3048,\n  yd: 0.9144,\n  mi: 1609.344\n}\n\nexport function convertDistanceToMeters(distance: number, unit: GeosearchDistanceUnit): number {\n  const ratio = mapDistanceToMeters[unit]\n\n  if (ratio === undefined) {\n    throw new Error(createError('INVALID_DISTANCE_SUFFIX', distance).message)\n  }\n\n  return distance * ratio\n}\n\nexport function removeVectorsFromHits(searchResult: Results<AnyDocument>, vectorProperties: string[]): void {\n  searchResult.hits = searchResult.hits.map((result) => ({\n    ...result,\n    document: {\n      ...result.document,\n      // Remove embeddings from the result\n      ...vectorProperties.reduce((acc, prop) => {\n        const path = prop.split('.')\n        const lastKey = path.pop()!\n        let obj = acc\n        for (const key of path) {\n          obj[key] = obj[key] ?? {}\n          obj = obj[key] as any\n        }\n        obj[lastKey] = null\n        return acc\n      }, result.document)\n    }\n  }))\n}\n"],"names":["createError","baseId","Date","now","toString","slice","lastId","k","nano","BigInt","milli","second","isServer","window","MAX_ARGUMENT_FOR_STACK","safeArrayPush","arr","newArr","length","Array","prototype","push","apply","newArrLength","i","sprintf","template","args","replace","replaceArgs","groups","width","rawWidth","type","position","replacement","Number","parseInt","shift","padStart","value","padding","precision","split","map","w","parseFloat","toFixed","padEnd","formatBytes","bytes","decimals","dm","sizes","Math","floor","log","pow","isInsideWebWorker","WorkerGlobalScope","self","isInsideNode","process","release","name","getNanosecondTimeViaPerformance","performance","formatNanoseconds","getNanosecondsTime","hrtime","bigint","uniqueId","getOwnProperty","object","property","Object","hasOwn","undefined","hasOwnProperty","call","getTokenFrequency","token","tokens","count","t","insertSortedValue","el","compareFn","sortTokenScorePredicate","low","high","mid","splice","a","b","intersect","arrays","tmp","set","Map","elem","found","get","filter","e","getDocumentProperties","doc","paths","properties","pathsLength","path","pathTokens","current","pathTokensLength","j","lat","lon","isArray","getNested","obj","props","flattenObject","prefix","result","key","prop","objKey","assign","mapDistanceToMeters","cm","m","km","ft","yd","mi","convertDistanceToMeters","distance","unit","ratio","Error","message","removeVectorsFromHits","searchResult","vectorProperties","hits","document","reduce","acc","lastKey","pop"],"mappings":"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"}